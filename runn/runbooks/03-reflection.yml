desc: "03 â€” gRPC Reflection: service discovery"
runners:
  greq:
    addr: server:5000
    tls: false
steps:
  discover_codebased:
    desc: "Discover codebased.v1.CodeBasedService via reflection"
    greq:
      codebased.v1.CodeBasedService/SayHello:
        message:
          name: "ReflectionTest"
    test: |
      current.res.status == 0 &&
      current.res.message.message == 'Hello, ReflectionTest!'

  discover_protobased:
    desc: "Discover protobased.v1.ProtoBasedService via reflection"
    greq:
      protobased.v1.ProtoBasedService/SayHello:
        message:
          name: "ReflectionTest"
    test: |
      current.res.status == 0 &&
      current.res.message.message == 'Hello, ReflectionTest!'

  discover_test_service:
    desc: "Discover test.v1.TestService via reflection"
    greq:
      test.v1.TestService/SlowMethod:
        message:
          delay_ms: 0
    test: |
      current.res.status == 0 &&
      current.res.message.message == 'Completed after 0ms'

  discover_health:
    desc: "Discover grpc.health.v1.Health via reflection"
    greq:
      grpc.health.v1.Health/Check:
        message: {}
    test: |
      current.res.status == 0
